FROM golang:alpine

ENV GO111MODULE=on \
    CGO_ENABLED=0 \
    GOOS=linux \
    GOARCH=amd64 \
    FIREBASE_CONFIG_SERVICE_ACCOUNT=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAic3F1YWQtMjY1ODAwIiwKICAicHJpdmF0ZV9rZXlfaWQiOiAiNjFlMmUwM2ViM2E5NjJkOWMzYzUxMGRhNmI4YzdkZGIzMDJhMGYzMSIsCiAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZRSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2N3Z2dTakFnRUFBb0lCQVFERDFFZUoyckxiQ1Q2VFxuS0p5RjBYUVh5QmNWdjI0WVgvS3FqRk9DSHg4M3FPdlAyelBURjdjVnU0WVFuYWl5VlhTS0NRdDRSeTQrbkx6SFxuT0dKYzhCeWlPNFFnRmtPT0tRSjRmUnk0VDZiTGRuNjZaUkJSeVZIVnVVSjhGMk1NTHA4S1Fob3UvVE5JUlgzTVxuZnJ3QVd1R1pzS2dId1ZUbGF3UElWUFdzMHhaV214YXluZC9SZm1SRkt4V2Q1SjRwWHhxaGxGcmZ2TnRMaStHN1xueDdJQ0hwY1Vxd1dlVVJDWllSY0tqdVI3d0c5aWkrMkhnUnJvemUrMTExelhJSHE1Wmh4MklVVEJmU0N1UFVmTVxuWGJPaUVQb0lZY0ZWZzczVmJaNFJodDZGc1VYMVp2RUdyMXB5YktVSk9VSVBGVC9BWUF1VGNpTEtqajVaQmcwd1xueVZYYWd2ckpBZ01CQUFFQ2dnRUFCaFlSWThsRHczSDRtMlhvNDNIUjRWd0FkNnU3bGc5WlZvL3c3U1kwSXF5TVxuZmxQS093dk5lV1B3SHBFVktVeGxuYXFsVEJ6WTVPendlR0thRUFNTnZobTFHVjJIeGt4NC9Wbi9iQUpjWlRqRVxuRWQxS2tnMThqblMrWDd2eHJKM0FVZmNob3R5UFhQWW44RDlFeERWa05lZHdlWGs2bEdkc2k5YUpkM3NYVjg2clxuM0RtNkM3TVR0N3lHZXNhMkl5aHkyYmVwTXNna2NCdWZXUkc4NW80RHVJT3lib1BkeHhNWndlaXRlQ3JUakh4M1xuZUpVWElWSFErdlAyV0wxZzZmWFB4R2hIeS9SSlA3MHdqcXJGV0x0UVc5RHpwUzgvOHNsbUhoVWZJYmFSWkhJM1xuYnYvM3FvRStvTmFKRnZqYjRwWWNKaERCbnVUMmpxSXZtVlZHOHFWdm53S0JnUUR0K2lqNWFnSUJSZTcwYmNZdFxuT0xudzdGQnlYa1BGSHNGTlBMbnllYnpsWDdRZUs4L2ljdWtCdDhwc0pta244bThpYURNb3l3M3ZRaWs5WXNpeFxub25JakJWTDRvbEhkMDIzbmw2WUhWb3RTR1RWbVdRNnZYZjZieW9ING1PWjFyVlNsdU9CSi96VHV2eTBpTTNaalxuL0RQQmpvM2NRcmNHYVY2bHlLTmRRcGhiT3dLQmdRRFNxUGNvNFUwcER2K3drL090V1NSRmhzZitQRTJpZmZuNFxuRG8zNHp2YnVpUEZzTDZwWTZXRmdWZFYrcUhjdEMvQjVTNFJjbXBxb0Q2OE1maE4vaFd4S0dtUW13NE5YUzk4blxuYWdlV0ViL2crcUpycjJlSFZFMkdtdjBlNFpUR3o3d3NSanovUVcvQVAvalI0K0ZkS290WExFNVVuQUN1QnJwL1xuOUhoNEZ2KzV5d0tCZ1FEb2g4aWp0TzZTbWVmY1ZLc1JJdDJsU1BOdVhTZHhKQlVUU0dRVlJ0akpjOU5HcTk2c1xuVVVYV0ZPVW8rZnRFT2tKWFoyT2QxNU1kRnhPKzFKaHY0ZUFPMGpQNW1IblArN2puVTZtNmY5a1FkbXRVUDI3MlxuOGl4SHcvOXRqdEdaYUsxT1pUQmJmWkFXUFIxM3pycy9CWDc1QVRjaVl0bjkzTlhMdmhuS2xialRZd0tCZ0FydlxuYm5VV3pQU1dyTHN6MHZCcXNqRlJ2OHY0d1didjl5dmpSWWRtNXZhVzhVRldjQmRSZGhhVUhoTUhGN2lrNkFURFxuNE1rVjFYVm42d1JRL3g0ZGhQT0x6eXNiOXhOdkF0Uis4b25kdmdJbHdJeXFmRXRRR3Y0anlZUHkzZEE4TkY1dlxuL3ZhWkpQM3IxRFRCQ1kvV2g0a3M2WndHeFJwRGl5YmRQK3VyOWZabEFvR0FSdHBBSmViRGdsSnR2djhHMkZNK1xuUGVzQWYwQlFSTUJwOTFaSGMwVXI0SHk1Rmx2UHQrQTRpSUt1aERrZzd1TDBhMzFtZkRTRWNrRFV2NHpIOUFYbFxuWU96WnUzYmdmLzk0NDdBcmxUYStVYm1pSURYVG9FN2hQVi9CZWh4di9jV1ZyajYreldiSXZkV3lYc2RXMklQMVxuMlBaKzJ2ZmhWMjlkTnZVcHBlYkV1M2M9XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstaGV5MzZAc3F1YWQtMjY1ODAwLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwNzQ0MTAyNzMzNzI5NTA3NTI0NiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZmlyZWJhc2UtYWRtaW5zZGstaGV5MzYlNDBzcXVhZC0yNjU4MDAuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0K \
    FIREBASE_CONFIG_CLIENT=ewogICAgImFwaUtleSI6ICJBSXphU3lDZ0hycnRsLTFtc2FKaWVaOElHcU82MHlyM294VzJIcjQiLAogICAgImF1dGhEb21haW4iOiAic3F1YWQtMjY1ODAwLmZpcmViYXNlYXBwLmNvbSIsCiAgICAiZGF0YWJhc2VVUkwiOiAiaHR0cHM6Ly9zcXVhZC0yNjU4MDAuZmlyZWJhc2Vpby5jb20iLAogICAgInByb2plY3RJZCI6ICJzcXVhZC0yNjU4MDAiLAogICAgInN0b3JhZ2VCdWNrZXQiOiAic3F1YWQtMjY1ODAwLmFwcHNwb3QuY29tIiwKICAgICJtZXNzYWdpbmdTZW5kZXJJZCI6ICIxMDI2ODMyNzk4OTgyIiwKICAgICJhcHBJZCI6ICIxOjEwMjY4MzI3OTg5ODI6d2ViOmVlM2U3ZDE2YmUzNTA0ZWI5ZjdhODciCiAgfQ==

# Move to working directory /build
WORKDIR /build

# Copy and download dependency using go mod
COPY go.mod .
COPY go.sum .
RUN go mod download

# Copy the code into the container
COPY . .

# Build the application
RUN go build -o main .

# Move to /dist directory as the place for resulting binary folder
WORKDIR /dist

# Copy binary from build to main folder
RUN cp /build/main .

# Export necessary port
EXPOSE 4444

# Command to run when starting the container
CMD ["/dist/main"]
